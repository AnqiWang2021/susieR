<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sum of Single Effects (SuSiE) Regression using summary statistics — susie_rss • susieR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Sum of Single Effects (SuSiE) Regression using summary statistics — susie_rss"><meta property="og:description" content="susie_rss performs variable selection under a
  sparse Bayesian multiple linear regression of \(Y\) on \(X\)
  using the z-scores from standard univariate regression
  of \(Y\) on each column of \(X\), an estimate \(R\) of
  the correlation matrix between columns of \(X\), and optionally
  but strongly recommended, the sample size n."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">susieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.00</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stephenslab/susieR" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sum of Single Effects (SuSiE) Regression using summary statistics</h1>
    <small class="dont-index">Source: <a href="https://github.com/stephenslab/susieR/blob/HEAD/R/susie_rss.R" class="external-link"><code>R/susie_rss.R</code></a></small>
    <div class="hidden name"><code>susie_rss.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>susie_rss</code> performs variable selection under a
  sparse Bayesian multiple linear regression of \(Y\) on \(X\)
  using the z-scores from standard univariate regression
  of \(Y\) on each column of \(X\), an estimate \(R\) of
  the correlation matrix between columns of \(X\), and optionally
  but strongly recommended, the sample size n.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">susie_rss</span><span class="op">(</span>
  <span class="va">z</span>,
  <span class="va">R</span>,
  <span class="va">n</span>,
  <span class="va">bhat</span>,
  <span class="va">shat</span>,
  <span class="va">var_y</span>,
  z_ld_weight <span class="op">=</span> <span class="fl">0</span>,
  estimate_residual_variance <span class="op">=</span> <span class="cn">FALSE</span>,
  prior_variance <span class="op">=</span> <span class="fl">50</span>,
  check_prior <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>z</dt>
<dd><p>A p-vector of z scores.</p></dd>
<dt>R</dt>
<dd><p>A p by p correlation matrix.</p></dd>
<dt>n</dt>
<dd><p>The sample size.</p></dd>
<dt>bhat</dt>
<dd><p>A p-vector of estimated effects.</p></dd>
<dt>shat</dt>
<dd><p>A p-vector of standard errors.</p></dd>
<dt>var_y</dt>
<dd><p>The sample variance of y, defined as \(y'y/(n-1)\).
When the sample variance cannot be provided, the coefficients
(returned from <code>coef</code>) are computed on the "standardized" X, y
scale.</p></dd>
<dt>z_ld_weight</dt>
<dd><p>This parameter is included for backwards
compatibility with previous versions of the function, but it is no
longer recommended to use a non-zero value. If <code>z_ld_weight
&gt; 0</code>, the matrix R used in the model is adjusted to be
<code>cov2cor((1-w)*R + w*tcrossprod(z))</code>, where <code>w =
z_ld_weight</code>.</p></dd>
<dt>estimate_residual_variance</dt>
<dd><p>The default is FALSE, the residual variance is
fixed to 1 or variance of y. If the in-sample LD matrix is provided, we
recommend <code>estimate_residual_variance = TRUE</code>, the residual variance is
estimated.</p></dd>
<dt>prior_variance</dt>
<dd><p>The prior variance(s) for the non-zero
element of \(\tilde{b}_l\). It is either a scalar, or a vector of length
L. When <code>estimate_prior_variance = TRUE</code> (highly recommended)
this simply provides an initial value for the prior variance, and
the default value of 50 is simply intended to be a large initial
value. This parameter is used only when <code>n</code> is unknown. If  {n</p></dd>
</dl><p>is known, please use <code>scaled_prior_variance</code> as in <code>susie</code> or
<code>susie_suff_stat</code>.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>"susie"</code> object with the following
  elements:</p>
<dl><dt>alpha</dt>
<dd><p>An L by p matrix of posterior inclusion probabilites.</p></dd>
<dt>mu</dt>
<dd><p>An L by p matrix of posterior means, conditional on
  inclusion.</p></dd>
<dt>mu2</dt>
<dd><p>An L by p matrix of posterior second moments,
  conditional on inclusion.</p></dd>
<dt>lbf</dt>
<dd><p>log-Bayes Factor for each single effect.</p></dd>
<dt>lbf_variable</dt>
<dd><p>log-Bayes Factor for each variable and single effect.</p></dd>
<dt>V</dt>
<dd><p>Prior variance of the non-zero elements of b.</p></dd>
<dt>elbo</dt>
<dd><p>The value of the variational lower bound, or
  “ELBO” (objective function to be maximized), achieved at
  each iteration of the IBSS fitting procedure.</p></dd>
<dt>sets</dt>
<dd><p>Credible sets estimated from model fit; see
  <code><a href="susie_get_methods.html">susie_get_cs</a></code> for details.</p></dd>
<dt>pip</dt>
<dd><p>A vector of length p giving the (marginal) posterior
  inclusion probabilities for all p covariates.</p></dd>
<dt>niter</dt>
<dd><p>Number of IBSS iterations that were performed.</p></dd>
<dt>converged</dt>
<dd><p><code>TRUE</code> or <code>FALSE</code> indicating whether
  the IBSS converged to a solution within the chosen tolerance
  level.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>In some applications, particularly genetic applications,
it is desired to fit a regression model (\(Y = Xb + E\)
say, which we refer to as "the original regression model" or ORM)
without access to the actual values of \(Y\) and \(X\), but
given only some summary statistics. <code>susie_rss</code> assumes the
availability of \(z\) scores from standard univariate regression
of \(Y\) on each column of \(X\), and an estimate \(R\) of
the correlation matrix between columns of \(X\) (\(R\) is
sometimes called the LD matrix in genetic applications).</p>
<p>With the inputs <code>z</code>, <code>R</code> and <code>n</code>, <code>susie_rss</code>
computes PVE-adjusted z-scores \(\tilde{z}\), and calls
<code>susie_suff_stat</code> with <code>XtX = (n-1)R</code>,
<code>Xty = </code> \(\sqrt{n-1} \tilde{z}\), <code>yty = n-1</code>, <code>n = n</code>.
The output effect estimates are on the scale of \(b\) in the ORM with
standardized \(X\) and \(y\).
When the LD matrix <code>R</code> and the z-scores <code>z</code> are computed
using the same matrix \(X\), the results from <code>susie_rss</code> are same as
(or very similar to) <code>susie</code> with standardized \(X\) and \(y\).
Alteratively, if the user provides <code>n</code> and <code>bhat</code> (the
univariate OLS estimates from regressing \(y\) on each column of \(X\)),
<code>shat</code> (the standard errrors from these OLS regressions), the
in-sample correlation matrix \(R = cov2cor(X'X)\), and the variance of
\(y\), the results from <code>susie_rss</code> are same as (or very
similar to) <code>susie</code> with original \(X\) and \(y\). The output
effect estimates are on the scale of \(b\) in the ORM with original
\(X\) and \(y\).</p>
<p>In rare cases where sample size \(n\) is unknown, <code>susie_rss</code> calls
<code>susie_suff_stat</code> with <code>XtX = R</code> and <code>Xty = z</code>,
and fixing <code>residual_variance = 1</code>, which assumes the sample size
is infinity and all the effects are small. It combines the
the log-likelihood for noncentrality parameters \(\tilde{b} = \sqrt{n} b\),
\(l(\tilde{b}; z,R) = -0.5(\tilde{b}'R\tilde{b} - 2z'\tilde{b})\),
with the “susie prior” which assumes that \(\tilde{b}
= \sum_{l=1}^L \tilde{b}_l\) where each \(\tilde{b}_l\) is a vector of length p
with exactly one non-zero element; see <code><a href="susie.html">susie</a></code> and Wang
et al (2020) for details. The output effect estimates are on the
noncentrality parameter scale.</p>
<p>The estimate residual variance is FALSE by default, which is recommended
when the LD matrix is estimated from a reference panel.
When the LD matrix <code>R</code> and the summary statistics <code>z</code>
(or <code>bhat</code>, <code>shat</code>) are computed using the same matrix
\(X\), we recommend setting estimate residual variance as TRUE.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>G. Wang, A. Sarkar, P. Carbonetto and M. Stephens (2020). A simple
  new approach to variable selection in regression, with application
  to genetic fine-mapping. <em>Journal of the Royal Statistical
  Society, Series B</em> <b>82</b>, 1273-1300 doi: <a href="https://doi.org/10.1101/501114" class="external-link">10.1101/501114</a>
.</p>
<p>Y. Zou, P. Carbonetto, G. Wang and M. Stephens (2021).
  Fine-mapping from summary data with the “Sum of Single Effects”
  model. <em>bioRxiv</em> doi: <a href="https://doi.org/10.1101/2021.11.03.467167" class="external-link">10.1101/2021.11.03.467167</a>
.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span class="r-in"><span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">p</span><span class="op">)</span></span>
<span class="r-in"><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span class="r-in"><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="va">n</span>,ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span class="r-in"><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span>,center <span class="op">=</span> <span class="cn">TRUE</span>,scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">input_ss</span> <span class="op">=</span> <span class="fu"><a href="compute_suff_stat.html">compute_suff_stat</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">y</span>,standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">ss</span>   <span class="op">=</span> <span class="fu"><a href="univariate_regression.html">univariate_regression</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">y</span><span class="op">)</span></span>
<span class="r-in"><span class="va">R</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">input_ss</span>,<span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">XtX</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">zhat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">ss</span>,<span class="va">betahat</span><span class="op">/</span><span class="va">sebetahat</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span>  <span class="op">=</span> <span class="fu">susie_rss</span><span class="op">(</span><span class="va">zhat</span>,<span class="va">R</span>, n<span class="op">=</span><span class="va">n</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> If the in-sample LD matrix is available, we recommend to call susie_rss with the in-sample LD matrix and estimate_residual_variance = TRUE.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">XtX is not symmetric; forcing XtX to be symmetric by replacing XtX with (XtX + t(XtX))/2</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Toy example illustrating behaviour susie_rss when the z-scores</span></span>
<span class="r-in"><span class="co"># are mostly consistent with a non-invertible correlation matrix.</span></span>
<span class="r-in"><span class="co"># Here the CS should contain both variables, and two PIPs should</span></span>
<span class="r-in"><span class="co"># be nearly the same.</span></span>
<span class="r-in"><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6.01</span><span class="op">)</span></span>
<span class="r-in"><span class="va">R</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">=</span> <span class="fu">susie_rss</span><span class="op">(</span><span class="va">z</span>,<span class="va">R</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> If the in-sample LD matrix is available, we recommend to call susie_rss with the in-sample LD matrix and estimate_residual_variance = TRUE.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The sample size is not provided. It's recommended to provide the sample size. Without the sample size, we assume n is infinity and the sample sizes are small.</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sets</span><span class="op">$</span><span class="va">cs</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">pip</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4854079 0.5145921</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In this second toy example, the only difference is that one</span></span>
<span class="r-in"><span class="co"># z-score is much larger than the other. Here we expect that the</span></span>
<span class="r-in"><span class="co"># second PIP will be much larger than the first.</span></span>
<span class="r-in"><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span></span>
<span class="r-in"><span class="va">R</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">=</span> <span class="fu">susie_rss</span><span class="op">(</span><span class="va">z</span>,<span class="va">R</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> If the in-sample LD matrix is available, we recommend to call susie_rss with the in-sample LD matrix and estimate_residual_variance = TRUE.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The sample size is not provided. It's recommended to provide the sample size. Without the sample size, we assume n is infinity and the sample sizes are small.</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">sets</span><span class="op">$</span><span class="va">cs</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">pip</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.001713869 0.998286131</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gao Wang, Yuxin Zou, Kaiqian Zhang, Peter Carbonetto, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

