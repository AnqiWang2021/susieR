<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diagnostic for fine-mapping with summary statistics • susieR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Diagnostic for fine-mapping with summary statistics">
<meta property="og:description" content="susieR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">susieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.52</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/susieR">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="susierss_diagnostic_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Diagnostic for fine-mapping with summary statistics</h1>
                        <h4 class="author">Yuxin Zou</h4>
            
            <h4 class="date">2021-08-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/susieR/blob/master/vignettes/susierss_diagnostic.Rmd"><code>vignettes/susierss_diagnostic.Rmd</code></a></small>
      <div class="hidden name"><code>susierss_diagnostic.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates diagnostic plot for consistency between summary statistics and refenrence LD matrix.</p>
<p>The <code>susie_rss</code> assumes the LD matrix accurately estimate the correlations among SNPs from the original GWAS genotype data. Typically, the LD matrix comes from some public database of genotypes in a suitable reference population. The inaccurate LD information leads to unreliable fine-mapping result.</p>
<p>The diagnostic for consistency between summary statistics and refenrence LD matrix is based on the RSS model under the null with regularized LD matrix. <span class="math display">\[
\hat{z} | R, s \sim N(0, (1-s)R + s I), 0&lt;s&lt;1
\]</span> The parameter <code>s</code> is estimated by maximum likelihood. A larger <code>s</code> means a greater inconsistency between summary statistics and the LD matrix. The expected z score is computed for each SNP, <span class="math inline">\(E(\hat{z}_j | \hat{z}_{-j})\)</span>, and plotted against the observed z scores.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/susieR">susieR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeroen/curl">curl</a></span><span class="op">)</span>
<span class="co"># Using libcurl 7.64.1 with LibreSSL/2.8.3</span></code></pre></div>
<div id="ld-information-from-the-original-genotype-data" class="section level2">
<h2 class="hasAnchor">
<a href="#ld-information-from-the-original-genotype-data" class="anchor"></a>LD information from the original genotype data</h2>
<p>We demonstrate the diagnostic plot in a simple case, the LD matrix is estimated from the original genotype data. We use the same simulated data as in <a href="finemapping.html">fine mapping vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"N3finemapping"</span><span class="op">)</span>
<span class="va">b</span> <span class="op">=</span> <span class="va">N3finemapping</span><span class="op">$</span><span class="va">true_coef</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">sumstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/univariate_regression.html">univariate_regression</a></span><span class="op">(</span><span class="va">N3finemapping</span><span class="op">$</span><span class="va">X</span>, <span class="va">N3finemapping</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">z_scores</span> <span class="op">&lt;-</span> <span class="va">sumstats</span><span class="op">$</span><span class="va">betahat</span> <span class="op">/</span> <span class="va">sumstats</span><span class="op">$</span><span class="va">sebetahat</span>
<span class="va">Rin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">N3finemapping</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Rin</span>, <span class="st">"eigen"</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">Rin</span>, symmetric <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="../reference/susie_plot.html">susie_plot</a></span><span class="op">(</span><span class="va">z_scores</span>, y <span class="op">=</span> <span class="st">"z"</span>, b<span class="op">=</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="susierss_diagnostic_files/figure-html/unnamed-chunk-2-1.png" alt="&amp;nbsp;" width="600"><p class="caption">
 
</p>
</div>
<p>The estimated <code>s</code> is</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimate_s_rss.html">estimate_s_rss</a></span><span class="op">(</span><span class="va">z_scores</span>, <span class="va">Rin</span><span class="op">)</span>
<span class="va">s</span>
<span class="co"># [1] 0.0001123485</span></code></pre></div>
<p>The plot for the expected z scores vs the observed z scores is</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">condz_in</span> <span class="op">=</span> <span class="fu"><a href="../reference/kriging_rss.html">kriging_rss</a></span><span class="op">(</span><span class="va">z_scores</span>, <span class="va">Rin</span><span class="op">)</span>
<span class="va">condz_in</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="susierss_diagnostic_files/figure-html/unnamed-chunk-4-1.png" alt="&amp;nbsp;" width="600"><p class="caption">
 
</p>
</div>
</div>
<div id="ld-information-from-the-reference-panel" class="section level2">
<h2 class="hasAnchor">
<a href="#ld-information-from-the-reference-panel" class="anchor"></a>LD information from the reference panel</h2>
<p>We use another simulated data where the LD matrix is estimated from a reference panel. There is one signal in the simulated data (red point). There is one SNP with mismatched reference and alternative allele between summary statistics and the reference panel (yellow point).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".RData"</span><span class="op">)</span>
<span class="va">data_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/stephenslab/susieR/"</span>,
                   <span class="st">"master/inst/datafiles/SummaryConsistency1k.RData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html">curl_download</a></span><span class="op">(</span><span class="va">data_url</span>,<span class="va">data_file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span>
<span class="va">zflip</span> <span class="op">=</span> <span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">z</span>
<span class="va">ld</span> <span class="op">=</span> <span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">ldref</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">zflip</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"#767676"</span>, main <span class="op">=</span> <span class="st">"Marginal Associations"</span>, 
     xlab<span class="op">=</span><span class="st">"SNP"</span>, ylab <span class="op">=</span> <span class="st">"z scores"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">signal_id</span>, <span class="va">zflip</span><span class="op">[</span><span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">signal_id</span><span class="op">]</span>, col<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">flip_id</span>, <span class="va">zflip</span><span class="op">[</span><span class="va">SummaryConsistency</span><span class="op">$</span><span class="va">flip_id</span><span class="op">]</span>, col<span class="op">=</span><span class="fl">7</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="susierss_diagnostic_files/figure-html/unnamed-chunk-5-1.png" alt="&amp;nbsp;" width="600"><p class="caption">
 
</p>
</div>
<p>The estimated <code>s</code> is</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimate_s_rss.html">estimate_s_rss</a></span><span class="op">(</span><span class="va">zflip</span>, <span class="va">ld</span><span class="op">)</span>
<span class="va">s</span>
<span class="co"># [1] 0.005371902</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">condz</span> <span class="op">=</span> <span class="fu"><a href="../reference/kriging_rss.html">kriging_rss</a></span><span class="op">(</span><span class="va">zflip</span>, <span class="va">ld</span><span class="op">)</span>
<span class="va">condz</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="susierss_diagnostic_files/figure-html/unnamed-chunk-7-1.png" alt="&amp;nbsp;" width="600"><p class="caption">
 
</p>
</div>
<p>The diagnostic plot identifies the SNP with flipped allele between summary statistics and the reference panel.</p>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h2>
<p>Here are some details about the computing environment, including the versions of R, and the R packages, used to generate these results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># R version 4.1.0 (2021-05-18)</span>
<span class="co"># Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co"># Running under: macOS Big Sur 10.16</span>
<span class="co"># </span>
<span class="co"># Matrix products: default</span>
<span class="co"># BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.dylib</span>
<span class="co"># LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib</span>
<span class="co"># </span>
<span class="co"># locale:</span>
<span class="co"># [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co"># </span>
<span class="co"># attached base packages:</span>
<span class="co"># [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co"># </span>
<span class="co"># other attached packages:</span>
<span class="co"># [1] curl_4.3.2     susieR_0.11.52</span>
<span class="co"># </span>
<span class="co"># loaded via a namespace (and not attached):</span>
<span class="co">#  [1] Rcpp_1.0.7        highr_0.9         plyr_1.8.6        compiler_4.1.0   </span>
<span class="co">#  [5] pillar_1.6.2      tools_4.1.0       digest_0.6.27     evaluate_0.14    </span>
<span class="co">#  [9] memoise_2.0.0     lifecycle_1.0.0   tibble_3.1.4      gtable_0.3.0     </span>
<span class="co"># [13] lattice_0.20-44   pkgconfig_2.0.3   rlang_0.4.11      Matrix_1.3-3     </span>
<span class="co"># [17] yaml_2.2.1        pkgdown_1.6.1     xfun_0.24         fastmap_1.1.0    </span>
<span class="co"># [21] dplyr_1.0.7       stringr_1.4.0     knitr_1.33        generics_0.1.0   </span>
<span class="co"># [25] desc_1.3.0        fs_1.5.0          vctrs_0.3.8       systemfonts_1.0.2</span>
<span class="co"># [29] tidyselect_1.1.1  rprojroot_2.0.2   grid_4.1.0        reshape_0.8.8    </span>
<span class="co"># [33] glue_1.4.2        R6_2.5.1          textshaping_0.3.5 fansi_0.5.0      </span>
<span class="co"># [37] rmarkdown_2.9     mixsqp_0.3-46     irlba_2.3.3       farver_2.1.0     </span>
<span class="co"># [41] purrr_0.3.4       ggplot2_3.3.5     magrittr_2.0.1    scales_1.1.1     </span>
<span class="co"># [45] htmltools_0.5.1.1 ellipsis_0.3.2    colorspace_2.0-2  labeling_0.4.2   </span>
<span class="co"># [49] ragg_1.1.3        utf8_1.2.2        stringi_1.7.3     munsell_0.5.0    </span>
<span class="co"># [53] cachem_1.0.5      crayon_1.4.1</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gao Wang, Yuxin Zou, Kaiqian Zhang, Peter Carbonetto, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
